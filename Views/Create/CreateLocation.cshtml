@model VolunteerPlanner.Models.Location

@{
    ViewData["Title"] = "Add Location";
}

<div class="row">
    <div class="col-12 mx-auto mt-5">
        <form asp-controller="Create" asp-action="AddLocation" method="post" class="form-control">
            <h2 class="text-center">@ViewData["Title"]</h2>
            <div class="col-5 d-inline-block align-top px-0">
                <div class="col-12 d-inline-block p-0 align-text-top my-2">
                    <label asp-for="Name" class="d-inline-block col-3 p-0 text-right"></label>
                    <input asp-for="Name" class="form-control d-inline-block col-8 m-auto" placeholder="Enter Location Name" aria-label="Enter Location Name" />
                    <span asp-validation-for="Name" class="d-block pl-3 offset-3 text-danger"></span>
                </div>
                <div class="col-12 d-inline-block p-0 align-text-top my-2 text-right pr-5">
                    <button class="btn btn-dark" type="submit">Add Location</button>
                </div>
            </div>
            <div class="col-6 d-inline-block align-top px-0">
                <div id="map" class="intrinsic-container intrinsic-container-16x9">

                </div>
            </div>

            <script>
                var map, infoWindow;

                function initMap() {
                    map = new google.maps.Map(document.getElementById('map'), {
                        center: {lat: -34.397, lng: 150.644},
                        zoom: 10
                    });
                    
                    infoWindow = new google.maps.InfoWindow;

                    map.addListener('click', function(e) {
                        placeMarkerAndPanTo(e.latLng, map);
                    });

                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                            var pos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };

                            // infoWindow.setPosition(pos);
                            // infoWindow.setContent('Location found.');
                            // infoWindow.open(map);
                            map.setCenter(pos);
                        }, function() {
                            handleLocationError(true, infoWindow, map.getCenter());
                        });
                    } else {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                    }
                }

                function placeMarkerAndPanTo(latLng, map) {
                    alert(latLng)
                    var marker = new google.maps.Marker({
                        position: latLng,
                        draggable:true,
                        title:"New Location",
                        map: map
                    });
                    map.panTo(latLng);
                }

                function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                    infoWindow.setPosition(pos);
                    infoWindow.setContent(browserHasGeolocation ?
                                        'Error: The Geolocation service failed.' :
                                        'Error: Your browser doesn\'t support geolocation.');
                    infoWindow.open(map);
                }
            </script>
            <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcFLcB_cuAHwGsWGlwHnYSY9VQcz3ioLc&callback=initMap"></script>
        </form>
    </div>
</div>
